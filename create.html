<html>
    <head>
        <title>AnonConfess - Create</title>
        <link rel="stylesheet" type = "text/css" href="create.css">
        <link href="https://fonts.googleapis.com/css2?family=Merienda+One&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Bellota+Text&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=K2D:wght@300&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro&display=swap" rel="stylesheet">
        <script src="https://www.google.com/recaptcha/api.js"></script>
    </head>
    <body>
        <div class="bgeffect">
            <div class="content">
                <div class="logo">
                    <h1><a href="index.html">AnonConfess</a></h1>
                    <p>Post your confessions anonymously, for other people to see and share.</p>
                </div>
                <div class="formDiv">
                    <form action="" method="post">
                        <p class="writeText">Write your confession : </p>
                        <textarea type="text" id="textbox" class="textbox" name="textbox" rows="14" cols="80"></textarea><br>
                        <div style="text-align:center;" class="g-recaptcha" data-sitekey="6LedoLMZAAAAAH-AB-N6r2ljvv9g4Ndocj4EacOY"></div>
                        <button class="submit" id="submit" type="submit" value="submit">SUBMIT</button>
                        <?php

                            if(isset($_POST['submit']))
                            {

                            function CheckCaptcha($userResponse) {
                                    $fields_string = '';
                                    $fields = array('secret' => '6LedoLMZAAAAABHxPAlmRqWzGSjbUL0KK5jAVrrA', 'response' => $userResponse);
    
                                    foreach($fields as $key=>$value){
                                        $fields_string .= $key . '=' . $value . '&';
                                        $fields_string = rtrim($fields_string, '&');
                                    }

                                    $ch = curl_init();
                                    curl_setopt($ch, CURLOPT_URL, 'https://www.google.com/recaptcha/api/siteverify');
                                    curl_setopt($ch, CURLOPT_POST, count($fields));
                                    curl_setopt($ch, CURLOPT_POSTFIELDS, $fields_string);
                                    curl_setopt($ch, CURLOPT_RETURNTRANSFER, True);

                                    $res = curl_exec($ch);
                                    curl_close($ch);

                                    return json_decode($res, true);
                                }


                                // Call the function CheckCaptcha
                                $result = CheckCaptcha($_POST['g-recaptcha-response']);

                                if ($result['success']) {
                                    //If the user has checked the Captcha box
                                    echo "Captcha verified Successfully";

                                } else {
                                    // If the CAPTCHA box wasn't checked
                                   echo '<script>alert("Error Message");</script>';
                                }
                            }
                                ?>
                    </form>
                </div>
                <div class="TOS">By Using Our Website, You Agree to Our <a href="TOS.pdf">Terms of Service</a></div>
            </div>
        </div>
    </body>
</html>
